
## Deployment

Deployment is one of the mechanisms for handling workloads (applications) in Kubernetes. It is managed by Kubernetes Deployment Controller.

In Kubernetes, controllers are control loops that watch the state of your cluster, then make or request changes where needed. Each controller tries to move the current cluster state closer to the desired state.

Deployment is an abstraction over ReplicaSet. Under the hood, Deployment creates a ReplicaSet which in turn creates pods on our cluster. As per the name, ReplicaSet is used for managing the replicas of our pods.

In summary, Controller reads the Deployment spec, forwards the pod configuration to ReplicaSet and then it creates the pods with proper replicas.



Deployement >> Replicaset >> POD 

Deployment-Controller>> ReplicationController>> pod 

dep1 >> 10 POds >> nginx 



#### Rolling updates Deployment:
Kubernetes promises zero down time and one of the reasons behind it is Rolling Deployments. With Rolling Deployments, Kubernetes makes sure that the traffic to the pods are not interrupted when updated pods are being deployed.


#### Rollback Deployment:
Rollback Deployment means, going back to the previous instance of the deployment if there is some issue with the current deployment.


#### Create deployment
```bash
kubectl create deployment  dep1 --image nginx --replicas 5
kubectl get deployments.apps
kubectl get pods
```
#### Check 
```bash
kubectl get rs
kubectl describe rs dep1-76fc7d5bb6
```
#### Scale 
```bash
kubectl scale deployment dep1 --replicas 10
```

## Rolling Update
```bash
kubectl describe deployments.apps dep1
````
#### Create Service
```bash
kubectl expose deployment dep1 --port 80
kubectl get service
curl 10.97.235.108    # Service IP 
```

## Rolling Back 
#### Image Change 
```bash
kubectl get deployments.apps dep1 -o yaml | grep name    # Check container name
kubectl set image deployments/dep1 nginx=httpd    # nginx = container name
```
#### Check previous rollback
```bash
kubectl get rs
kubectl rollout history deployment dep1
kubectl rollout history deployment dep1 --revision=1
kubectl rollout history deployment dep1 --revision=2
```
#### Roll Back to Previous state
```bash
kubectl rollout undo deployment dep1
curl 10.97.235.108
```

#### Rollout (set rivision)
```bash
kubectl rollout history deployment dep1
kubectl get deployments.apps dep1 -o yaml | grep image    # current image
kubectl rollout undo deployment dep1 --to-revision=2
```






## Deployment Create with namespace
```bash
kubectl get namespaces
kubectl create namespace cka3
kubectl get pods --namespace cka3
```

Deployment Create >> deploy1 >> ReplicaSet

```bash
kubectl explain deployment
```

Create a file name deployment.yaml
```bash
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: demodeployment1
spec:
  replicas: 5
  template:
    metadata:
      name: pod1
      labels:
        dept: cse
        batch: sixth
    spec:
      containers:
       - name: doc1
         image: nginx
  selector:
   matchLabels:
     dept: cse
     batch: sixth
```


```bash
kubectl apply -f deployment.yaml --namespace cka3
kubectl get pods --namespace cka3
```

### Scale 
```bash
kubectl scale deployment --replicas 10 --namespace cka3 demodeployment1
```
### Image change
```bash
kubectl set image deployment/demodeployment1 doc1=redis --namespace cka3
kubectl describe deployments.apps --namespace cka3 demodeployment1  (image will be update nginx to redis)
```



### Edit deployment (edit replica 5 to 10)
```bash

```
